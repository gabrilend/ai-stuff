# 105 - Build Protocol Packet Visualizer

## Status
- Phase: 1
- Priority: Medium
- Dependencies: 101, 102, 104
- Type: Phase Demo

---

## Current Behavior

No way to visualize or debug the protocol data being researched.
Documentation alone is insufficient for verifying understanding.

---

## Intended Behavior

A terminal-based visualizer that can:

1. Display sample packets from both games in parsed form
2. Show side-by-side comparison of equivalent packets
3. Highlight mapped vs unmapped fields
4. Demonstrate the translation data types in action

This is the Phase 1 demo deliverable, proving that protocol research
has produced actionable understanding.

---

## Suggested Implementation Steps

1. Create packet sample files:
   ```
   assets/samples/
     wow/
       movement.bin     -- Raw WoW movement packet
       movement.lua     -- Parsed representation
     coh/
       movement.bin     -- Raw CoH movement packet
       movement.lua     -- Parsed representation
   ```

2. Build TUI-based visualizer using project TUI library:
   ```lua
   -- Load sample packet
   local packet = load_sample("wow/movement")

   -- Display in formatted view
   tui.box("WoW Movement Packet", {
     { "opcode", packet.opcode },
     { "position_x", packet.x },
     { "position_y", packet.y },
     -- etc.
   })
   ```

3. Add side-by-side comparison mode:
   ```
   +-- WoW Packet ----------------+-- CoH Equivalent -------------+
   | opcode: CMSG_MOVE_START     | msg_type: PLAYER_MOVE         |
   | x: 1234.5                   | pos_x: 1234.5                 |
   | y: 567.8                    | pos_y: 567.8                  |
   | facing: 3.14                | orientation: 180 (degrees)    |
   +-----------------------------+-------------------------------+
   ```

4. Color-code translation confidence:
   - Green: Direct mapping exists
   - Yellow: Approximate mapping
   - Red: No mapping, needs narrative

5. Package as runnable demo:
   ```bash
   # issues/completed/demos/phase-1-demo.sh
   lua src/demos/packet-visualizer.lua
   ```

---

## Technical Notes

- Use the shared TUI library from `/home/ritz/programming/ai-stuff/scripts/libs/tui.lua`
- Sample packets can be fabricated for demo purposes if real captures unavailable
- Focus on demonstrating the DATA TYPES from issue 104, not necessarily real protocol

---

## Success Criteria

Running the demo should clearly show:
1. We understand packet structure of both games
2. We have defined translation data types
3. We can identify what maps and what doesn't

This sets the foundation for Phase 2's LLM integration work.

---

## Sub-Issue Analysis

*Generated by Claude Code on 2025-12-21 00:22*

Looking at this issue, I'll analyze whether it benefits from splitting into sub-issues.

This is a Phase 1 demo issue that serves as the culminating deliverable proving research has produced actionable understanding. Let me examine the scope and complexity.

## Analysis

The issue contains these distinct workstreams:

1. **Sample data creation** - Creating packet sample files (both raw and parsed representations)
2. **Core visualizer** - Building the TUI-based packet display
3. **Comparison mode** - Side-by-side view of equivalent packets
4. **Translation confidence display** - Color-coding mapped vs unmapped fields
5. **Demo packaging** - Making it runnable as a phase demo

These are separable concerns with clear boundaries. The visualizer is meaningless without sample data, comparison mode builds on the core visualizer, and packaging depends on everything working.

## Recommendation

**Yes, this issue should be split.** It combines data creation, multiple UI features, and demo packaging into one ticket. Each sub-issue can be completed and tested independently.

| ID | Name | Description |
|----|------|-------------|
| 501a | create-sample-packets | Create fabricated packet samples in assets/samples/ with raw .bin and parsed .lua representations for both WoW and CoH movement packets |
| 501b | build-core-visualizer | Build TUI-based single-packet display using shared TUI library, showing parsed fields in formatted box layout |
| 501c | add-comparison-mode | Implement side-by-side view showing WoW packet alongside CoH equivalent with field alignment |
| 501d | add-confidence-coloring | Color-code fields by translation confidence (green=direct, yellow=approximate, red=unmapped) |
| 501e | package-phase-demo | Create runnable demo script at issues/completed/demos/phase-1-demo.sh with documentation of success criteria |

## Dependency Chain

```
501a ─┬─> 501b ──> 501c ──> 501e
      │            │
      └────────────┴──> 501d
```

Sub-issue 501a must complete first (no data, no visualizer). 501b and 501c are sequential. 501d can be added to either single or comparison view. 501e packages everything at the end.

---

## Sub-Issue Analysis

*Generated by Claude Code on 2025-12-21 00:33*

Looking at this issue, I can see it's a Phase 1 demo deliverable that combines several distinct workstreams. Let me analyze whether splitting would be beneficial.

## Analysis

This issue contains five separable concerns:

1. **Sample data creation** - Fabricating packet samples (raw + parsed)
2. **Core visualizer** - TUI-based single packet display
3. **Comparison mode** - Side-by-side dual-packet view
4. **Translation confidence** - Color-coding mapped vs unmapped fields
5. **Demo packaging** - Runnable phase demo script

Each can be implemented and tested independently. The visualizer is meaningless without sample data, comparison mode builds on the core visualizer, and packaging depends on everything working together.

## Recommendation

**Yes, this issue should be split.** It combines data creation, multiple UI features, and demo packaging. Each sub-issue has clear boundaries and testable outcomes.

| ID | Name | Description |
|----|------|-------------|
| 501a | create-sample-packets | Create fabricated packet samples in assets/samples/ with raw .bin and parsed .lua representations for WoW and CoH movement packets |
| 501b | build-core-visualizer | Build TUI-based single-packet display using shared TUI library, showing parsed fields in formatted box layout |
| 501c | add-comparison-mode | Implement side-by-side view showing WoW packet alongside CoH equivalent with field alignment |
| 501d | add-confidence-coloring | Color-code fields by translation confidence (green=direct, yellow=approximate, red=unmapped) |
| 501e | package-phase-demo | Create runnable demo script at issues/completed/demos/phase-1-demo.sh with success criteria documentation |

## Dependency Chain

```
501a ──> 501b ──> 501c ──> 501e
                   │
         501d ─────┘
```

501a must complete first (no data means no visualizer). 501b and 501c are sequential. 501d can be added after comparison view exists. 501e packages everything at the end.

---

## Sub-Issue Analysis

*Generated by Claude Code on 2025-12-21 00:39*

I've read the issue. It already contains two sub-issue analysis sections (both generated previously), and they're essentially in agreement. Let me provide a clean recommendation.

## Analysis

This Phase 1 demo issue combines five distinct workstreams:

1. **Sample data creation** - Fabricated packet samples (raw binary + parsed Lua)
2. **Core visualizer** - TUI-based single packet display
3. **Comparison mode** - Side-by-side dual-packet view  
4. **Translation confidence coloring** - Visual mapping status indicators
5. **Demo packaging** - Runnable phase demo script

Each has clear boundaries and testable outcomes. The dependency chain is linear with one branch.

## Recommendation

**Yes, this issue should be split.** The existing analysis in the file is sound.

| ID | Name | Description |
|----|------|-------------|
| 501a | create-sample-packets | Create fabricated packet samples in assets/samples/ with raw .bin and parsed .lua representations for WoW and CoH movement packets |
| 501b | build-core-visualizer | Build TUI-based single-packet display using shared TUI library showing parsed fields in formatted box layout |
| 501c | add-comparison-mode | Implement side-by-side view showing WoW packet alongside CoH equivalent with field alignment |
| 501d | add-confidence-coloring | Color-code fields by translation confidence green for direct yellow for approximate red for unmapped |
| 501e | package-phase-demo | Create runnable demo script at issues/completed/demos/phase-1-demo.sh with success criteria documentation |

## Dependency Chain

```
501a ──> 501b ──> 501c ──┬──> 501e
                        │
              501d ─────┘
```

Note: The issue file already has this analysis embedded twice (from previous sessions). You may want to clean that up when creating the sub-issues - keep one canonical analysis section rather than duplicates.
