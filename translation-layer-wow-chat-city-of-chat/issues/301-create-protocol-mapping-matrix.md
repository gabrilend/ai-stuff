# 103 - Create Protocol Mapping Matrix

## Status
- Phase: 1
- Priority: High
- Dependencies: 101, 102

---

## Current Behavior

Even once both protocols are documented separately, there is no
systematic comparison showing how data maps between them.

---

## Intended Behavior

A mapping document (`docs/protocol-mapping.md`) should exist that:

1. Lists every major data type from both games side-by-side
2. Indicates translation feasibility for each pair
3. Notes where narrative system must fill gaps
4. Provides translation priority ordering

The matrix should answer: "When WoW sends X, what does CoH receive?"
and vice versa.

---

## Suggested Implementation Steps

1. Create initial comparison categories:
   - Character identity (name, race, class <-> archetype)
   - Position/movement (coordinates, facing, speed)
   - Combat (abilities, damage, CC, healing)
   - Social (chat, party, guild <-> supergroup)
   - Inventory (items, currency)
   - Progression (XP, levels, talents <-> powers)

2. For each category, create sub-mappings:
   - Direct equivalents (1:1 mapping)
   - Approximate equivalents (requires conversion)
   - No equivalent (requires narrative generation)
   - Incompatible (cannot translate, must ignore or fake)

3. Build translation lookup tables:
   ```lua
   wow_to_coh = {
     ["WARRIOR"] = "TANKER",
     ["WARLOCK"] = "MASTERMIND", -- close enough?
     -- etc.
   }
   ```

4. Document bidirectional asymmetries:
   - Some translations work one way but not the other
   - Example: CoH costume data has no WoW equivalent

5. Prioritize by gameplay impact:
   - P0: Movement, combat basics (game unplayable without)
   - P1: Abilities, stats (degraded experience)
   - P2: Social features (quality of life)
   - P3: Cosmetics (nice to have)

---

## Deliverable Format

```markdown
## Movement Data

| WoW Field | CoH Equivalent | Direction | Notes |
|-----------|----------------|-----------|-------|
| position_x | pos_x | bidirectional | Scale factor needed |
| facing | orientation | bidirectional | Radians vs degrees |
| mount_id | travel_power | wow->coh only | Map to flight/super speed |
```

---

## Notes

This matrix will be the primary reference for the Translation Engine
implementation in Phase 2+. It should be treated as a living document
that evolves as edge cases are discovered.

---

## Sub-Issue Analysis

*Generated by Claude Code on 2025-12-21 00:21*

## Analysis

This issue (301) covers creating a **Protocol Mapping Matrix** - a cross-reference document that maps WoW protocol elements to CoH equivalents. Looking at the suggested implementation steps, there are 6 distinct categories to map, plus infrastructure work around the mapping methodology itself.

The issue explicitly identifies these comparison domains:
- Character identity
- Position/movement  
- Combat
- Social
- Inventory
- Progression

Each domain requires:
1. Analyzing both protocols' data structures
2. Classifying translation feasibility (direct, approximate, narrative, incompatible)
3. Building bidirectional lookup tables
4. Assigning priority levels

Given the scale (6 categories × 4 translation types × 2 directions = substantial matrix), splitting makes sense. However, I'd recommend a slightly different structure than splitting purely by category - the first sub-issue should establish the matrix format and methodology, then subsequent issues can fill in each domain.

## Recommended Sub-Issues

| ID | Name | Description |
|----|------|-------------|
| 301a | establish-matrix-format | Create docs/protocol-mapping.md with template structure, feasibility classifications, and priority definitions |
| 301b | map-movement-position | Map position coordinates, facing angles, speed, and travel powers between both protocols |
| 301c | map-character-identity | Map name, race/origin, class/archetype, and appearance data with lookup tables |
| 301d | map-combat-abilities | Map abilities, damage types, CC effects, and healing between power systems |
| 301e | map-social-systems | Map chat channels, party/team, and guild/supergroup structures |
| 301f | map-inventory-currency | Map item systems, currency types, and enhancement equivalents |
| 301g | map-progression-systems | Map XP, levels, talents/powers, and advancement mechanics |
| 301h | document-asymmetries | Catalog bidirectional translation gaps and propose narrative solutions for unmappable data |

Sub-issue 301a must complete first to establish the document structure. After that, 301b-301g can proceed in priority order (movement first as P0). Sub-issue 301h should be completed last as it synthesizes gaps discovered during the other mapping work.

---

## Sub-Issue Analysis

*Generated by Claude Code on 2025-12-21 00:32*

Looking at this issue, I can see it's already been analyzed and has sub-issue recommendations at the bottom. Let me evaluate whether those recommendations are appropriate or if adjustments are needed.

## Assessment

The existing analysis is solid. The issue covers creating a comprehensive protocol mapping matrix across 6 distinct domains, each requiring substantial research and documentation work. The current recommendation of 8 sub-issues is reasonable given the scope.

However, I'd suggest one refinement: **301h (document-asymmetries)** could be folded into each domain-specific issue rather than being a separate task. Asymmetries are best documented as they're discovered during mapping, not as a retroactive sweep. This would reduce cognitive overhead and ensure gaps are captured in context.

## Refined Recommendations

| ID | Name | Description |
|----|------|-------------|
| 301a | establish-matrix-format | Create docs/protocol-mapping.md with template structure, feasibility classifications (direct/approximate/narrative/incompatible), and priority tiers (P0-P3) |
| 301b | map-movement-position | Map position coordinates, facing angles, speed values, and travel powers; document scale factors and coordinate system differences |
| 301c | map-character-identity | Map name constraints, race/origin equivalents, class/archetype lookup tables, and appearance data limitations |
| 301d | map-combat-abilities | Map ability structures, damage types, crowd control effects, and healing mechanics between power systems |
| 301e | map-social-systems | Map chat channel types, party/team structures, guild/supergroup hierarchies, and friend list systems |
| 301f | map-inventory-currency | Map item slot systems, currency types, and enhancement/gem equivalents |
| 301g | map-progression-systems | Map XP curves, level caps, talent trees vs power pools, and badge/achievement systems |

**Note**: Each domain issue (301b-301g) should include documenting asymmetries and narrative gaps within that domain, rather than deferring to a separate pass. This keeps related information together and prevents context loss.

**Dependency chain**: 301a → (301b as P0 priority) → remaining issues can parallelize based on available protocol research from issues 101/102.

---

## Sub-Issue Analysis

*Generated by Claude Code on 2025-12-21 00:38*

Looking at this issue, I can see it's already been analyzed twice with sub-issue recommendations. Let me provide a fresh evaluation.

## Assessment

This issue covers creating a comprehensive protocol mapping matrix across 6 distinct domains (character identity, movement, combat, social, inventory, progression). Each domain requires research into both protocols, classification of translation feasibility, building lookup tables, and priority assignment. The scope clearly justifies splitting.

The existing analyses are reasonable, but I'd consolidate slightly. The "establish-matrix-format" task is lightweight and could be done inline with the first domain mapping. Similarly, "document-asymmetries" should happen within each domain rather than as a separate pass.

## Recommendations

| ID | Name | Description |
|----|------|-------------|
| 301a | map-movement-position | Create docs/protocol-mapping.md structure; map position, facing, speed, and travel powers as P0 priority items |
| 301b | map-character-identity | Map name constraints, race/origin, class/archetype lookup tables, and document appearance data gaps |
| 301c | map-combat-abilities | Map ability opcodes, damage types, crowd control effects, healing mechanics, and cooldown systems |
| 301d | map-social-systems | Map chat channels, party/team structures, guild/supergroup hierarchies, and messaging formats |
| 301e | map-inventory-progression | Map item slots, currency types, XP curves, levels, and talent/power advancement systems |

**Rationale for consolidation**:
- Combined inventory and progression (301f + 301g in previous analysis) since both relate to character advancement state
- Removed separate "establish-matrix-format" since the document template can be created alongside the first mapping (movement)
- Removed separate "document-asymmetries" since gaps should be noted in-context during each domain's analysis

**Dependency**: 301a establishes the document and covers P0 gameplay-critical data. Remaining issues (301b-301e) can proceed based on protocol research availability from issues 101/102.
